---
layout: post
title:  "Z80 Virtual Machine - Part 1"
date:   2017-01-24 00:19:05 
categories: z80 vm asm
---
This will be a series of short articles with the intent to build a functioning Z80 virtual machine.  This first part will act as an introduction to both the Z80 and virtual machines in general.  To make this more approachable, we will not set out to reproduce the Z80 in its entirety, we will work with a reduced set of registers and thus a reduced number of instructions.  We are taking a shortcut basing our VM on a well known and documented machine, you can also define your own registers (or just use a stack) and ISA and use what you learn here to implement your very own virtual machine.  You can even take it a step further and create a compiler for your very own high-level language that runs on your VM (think Java or C#, which run on the Java Virtual Machine or Common Language Runtime, respectively).

### Z80 Introduction
First, a very quick history lesson, then on to the interesting bits (no pun).  The Z80 is an 8-bit microprocessor available since 1976 (yes, I said since 1976, it is still in production).  The Z80 was a popular processor for use in arcade and video game consoles of the 70s and 80s and, along with the MOS Technology 6502, powered much of the early home computer market.

### Z80 Register Set and Instruction Set Architecture (ISA)
Now for the good stuff, the technical stuff.  As a (low level) programmer, our view of a machine is defined by a few things, the registers available to us, the memory available to us and the instructions we use to tie it all together and tell the machine what to do.
What follows is a run down of the most important registers of the Z80, enough to get us started with our basic Z80 VM.  This is NOT a complete representation, the alternate registers are not present, for example.  The [Z80 Wikipedia page](https://en.wikipedia.org/wiki/Zilog_Z80) is an excellent resource for detailed information.

The Z80 is defined by a set of 8 main 8-bit registers, ``A``, ``B``, ``C``, ``D``, ``E``, ``F``, ``H`` and, ``L``.  These can be paired in the following manner to create 16-bit registers, ``BC``, ``DE``, and ``HL``.  In addition to these 8-bit registers there are 2 more important registers to be aware of, they are the ``SP`` and the ``PC``.  The ``SP`` is the stack pointer, the stack is a just section of memory pointed to by the contents of ``SP``.  That is to say the ``SP`` contains the address of the current top of the stack.    
